<script type="text/discourse-plugin" version="0.8">
const { iconNode } = require("discourse-common/lib/icon-library");

if (api.getCurrentUser() === null) return false;

api.decorateWidget("header-icons:before", helper => {

  let container = api.container,
    ntb_title = settings.New_topic_button_title,
    ntb_icon = settings.New_topic_button_icon,
    ntb_button_class = "header-dropdown-toggle icon btn-flat",
    ntb_button_helper = "li#header-create-topic",
    ntb_label_helper = "span.d-button-label",
    composerModal = require("discourse/models/composer").default,
    composerController = container.lookup("controller:composer");

  const createTopic = function() {

    composerController.open({
      action: composerModal.CREATE_TOPIC,
      draftKey: controller.get("model.draft_key") || composerModal.NEW_TOPIC_KEY,
      draftSequence: controller.get("model.draft_sequence") || 0,
    });
  };

  return helper.h(
    ntb_button_helper,
    {
      className: ntb_button_class,
      title: ntb_title,
      onclick: createTopic
    },
    [iconNode(ntb_icon)]
  );
});
</script>
